<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
      }
      select, input {
        width: 100%;
        padding: 5px;
        margin-bottom: 10px;
        box-sizing: border-box;
      }
      .button {
        background-color: #4CAF50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
      }
      .button:hover {
        background-color: #45a049;
      }
    </style>
  </head>
  <body>
    <div class="form-group">
      <label for="invoiceNumber">Invoice Number:</label>
      <input type="text" id="invoiceNumber" required>
    </div>

    <div class="form-group">
      <label for="companySelect">Select Your Company:</label>
      <select id="companySelect" required></select>
    </div>
    
    <div class="form-group">
      <label for="contragentSelect">Select Contragent:</label>
      <select id="contragentSelect" required></select>
    </div>

    <div class="form-group">
      <label for="currencySelect">Currency:</label>
      <select id="currencySelect">
        <option value="USD" selected>USD</option>
        <option value="EUR">EUR</option>
        <option value="GBP">GBP</option>
      </select>
    </div>
    
    <button class="button" onclick="generateInvoice()">Generate Invoice</button>
    
    <script>
      // Load company and contragent data when the dialog opens
      google.script.run.withSuccessHandler(loadCompanies).getCompanyData();
      google.script.run.withSuccessHandler(loadContragents).getContragentData();
      
      function loadCompanies(companies) {
        var select = document.getElementById('companySelect');
        companies.forEach(function(company, index) {
          var option = document.createElement('option');
          option.value = index;
          option.text = company.name;
          select.appendChild(option);
        });
      }
      
      function loadContragents(contragents) {
        var select = document.getElementById('contragentSelect');
        contragents.forEach(function(contragent, index) {
          var option = document.createElement('option');
          option.value = index;
          option.text = contragent.companyName;
          select.appendChild(option);
        });
      }
      
      function generateInvoice() {
        var invoiceNumber = document.getElementById('invoiceNumber').value;
        var companyIndex = document.getElementById('companySelect').value;
        var contragentIndex = document.getElementById('contragentSelect').value;
        var currency = document.getElementById('currencySelect').value;
        
        if (!invoiceNumber) {
          alert('Please enter an invoice number');
          return;
        }

        var invoiceData = {
          invoiceNumber: invoiceNumber,
          companyIndex: companyIndex,
          contragentIndex: contragentIndex,
          currency: currency
        };
        
        google.script.run
          .withSuccessHandler(function() {
            google.script.host.close();
          })
          .withFailureHandler(function(error) {
            alert('Error: ' + error.message);
          })
          .generateInvoicePDF(invoiceData);
      }
    </script>
  </body>
</html>
